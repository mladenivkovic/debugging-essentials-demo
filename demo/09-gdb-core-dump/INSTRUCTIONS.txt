09 GDB Core Dumps
=============================

1   Look through the source code of the program.
    The base program is the same as in exampe 08-gdb-segfault.

2   Don't forget to compile with the debug flags! Point them out on the compile
    command. To compile the code, run `make`, or the full compilation command
    manually, e.g.

        $ make

    or

        $ gcc main.c -o ex -g -lm

3   run the program:

        $ ./ex

    It should crash with a Segfault.

4   Enable core dumps on your machine.

        $ ulimit -S unlimited
        $ ulimit -c unlimited

5   Find out in which directory your system will dump the cores. This may be
    accomplished by running

        $ coredumpctl info

    This will show you the info of the latest core dump on your machine.
    Look for the line starting with `Storage` to find where it is stored.

    To see a list of available programs, use

        $ coredumpctl list -r

    `-r` will display all entries in reverse, i.e. newest first.

    If that doesn't work for you, you'll have to search the internet for 
    answers. Install coredumpctl, or look where the default coredump storage is
    for your operating system. For Ubuntu 21+, the location is
    `/var/lib/apport/coredump/`

6   Run the program again:

        $ ./ex

    It should crash with a Segfault again.

6.1 Check your coredump directory. It should now contain a new file.
    Get the full file path and name. We'll need it in the next step.

7   Load the core dump with gdb, and tell gdb which executable was used to
    produce the core dump using

        $ gdb -c /path/to/core/file /path/to/executable

    In our case:

        $ gdb -c /path/to/core/file ./ex

    gdb should now load up the state of your program just as it crashed.


7.1 Some operating systems compress their core dumps first. In that case,
    you'll need to uncompress it first, or use `coredumpctl` to launch gdb
    instead:

        $ coredumpctl debug

    If `coredumpctl` doesn't find gdb, you can tell it which to use:

        $ coredumpctl debug --debugger=/path/to/gdb

    Alterantely, you can use `coredumpctl` to create a core dump:

        $ coredumpctl dump --output <filename_you_want_your_core_dump_to_have>

    and then launch using gdb:
        
        $ gdb -c <filename_you_want_your_core_dump_to_have> ./ex


